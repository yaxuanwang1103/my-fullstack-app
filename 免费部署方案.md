# 🆓 免费云部署方案完整指南

本指南提供多个免费或低成本的云部署方案，适合个人项目和学习使用。

---

## 📊 免费方案对比

| 平台 | 免费额度 | 支持 Docker | 支持数据库 | 需要信用卡 | 推荐度 |
|------|---------|------------|-----------|-----------|--------|
| **Railway** | $5/月 | ✅ | ✅ PostgreSQL | ❌ | ⭐⭐⭐⭐⭐ |
| **Render** | 750h/月 | ✅ | ✅ 90天免费 | ❌ | ⭐⭐⭐⭐ |
| **Fly.io** | 3 VM | ✅ | ✅ 3GB | ❌ | ⭐⭐⭐⭐ |
| **Vercel** | 无限 | ❌ | ❌ | ❌ | ⭐⭐⭐ |
| **AWS 免费** | 12个月 | ✅ | ✅ 750h/月 | ✅ | ⭐⭐⭐ |

---

## 🚀 方案1: Railway（最推荐）

### 为什么选择 Railway？

- ✅ **完全免费开始**（无需信用卡）
- ✅ **每月 $5 免费额度**（足够小项目使用）
- ✅ **支持 Docker Compose**
- ✅ **内置 PostgreSQL**
- ✅ **自动 HTTPS**
- ✅ **GitHub 自动部署**
- ✅ **最接近您现有的 Docker 配置**

### 部署步骤

#### 1. 注册 Railway 账号

1. 访问：https://railway.app/
2. 点击 **"Start a New Project"**
3. 使用 GitHub 账号登录（推荐）
4. 无需信用卡

#### 2. 准备项目

确保您的代码已推送到 GitHub：

```powershell
cd c:\Users\95150\OneDrive\桌面\my-fullstack-app

# 提交所有更改
git add .
git commit -m "Prepare for Railway deployment"
git push
```

#### 3. 创建 PostgreSQL 数据库

1. 在 Railway 控制台，点击 **"+ New"**
2. 选择 **"Database"** → **"PostgreSQL"**
3. 等待数据库创建完成
4. 点击数据库，查看 **"Connect"** 标签
5. 复制以下信息：
   - `PGHOST`
   - `PGPORT`
   - `PGDATABASE`
   - `PGUSER`
   - `PGPASSWORD`

#### 4. 部署后端B（数据存储服务）

1. 点击 **"+ New"** → **"GitHub Repo"**
2. 选择您的仓库 `my-fullstack-app`
3. Railway 会自动检测到项目
4. 点击 **"Add variables"** 添加环境变量：
   ```
   PORT_B=4000
   POSTGRES_HOST=从数据库复制
   POSTGRES_PORT=从数据库复制
   POSTGRES_DB=从数据库复制
   POSTGRES_USER=从数据库复制
   POSTGRES_PASSWORD=从数据库复制
   ```
5. 点击 **"Settings"**：
   - **Root Directory**: `/backend-b`
   - **Start Command**: `node server.js`
6. 点击 **"Deploy"**
7. 部署完成后，点击 **"Generate Domain"** 获取 URL
8. **保存这个 URL**（例如：`https://backend-b-production.up.railway.app`）

#### 5. 部署后端A（智能分类服务）

1. 点击 **"+ New"** → **"GitHub Repo"**
2. 选择相同的仓库
3. 添加环境变量：
   ```
   PORT=3000
   BACKEND_B_URL=https://backend-b-production.up.railway.app
   ```
   （使用步骤4获取的后端B URL）
4. 点击 **"Settings"**：
   - **Root Directory**: `/backend-a`
   - **Start Command**: `node server.js`
5. 点击 **"Deploy"**
6. 生成域名并**保存 URL**

#### 6. 部署前端

1. 点击 **"+ New"** → **"GitHub Repo"**
2. 选择相同的仓库
3. 添加环境变量：
   ```
   VITE_API_URL=https://backend-a-production.up.railway.app
   ```
4. 点击 **"Settings"**：
   - **Root Directory**: `/frontend`
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm run preview -- --host 0.0.0.0 --port $PORT`
5. 点击 **"Deploy"**
6. 生成域名

#### 7. 访问应用

在浏览器中打开前端的 Railway 域名，您的应用就部署好了！

### 本地连接 Railway 数据库

在 DBeaver 中创建新连接：

```
Host: 从 Railway 复制 PGHOST
Port: 从 Railway 复制 PGPORT
Database: 从 Railway 复制 PGDATABASE
Username: 从 Railway 复制 PGUSER
Password: 从 Railway 复制 PGPASSWORD
```

### Railway 成本

- **免费额度**: $5/月
- **小项目估算**: 通常在免费额度内
- **超出后**: 按使用量付费（约 $0.000463/GB-hour）

---

## 🚀 方案2: Render

### 优势

- ✅ 完全免费（有限制）
- ✅ 支持 Docker
- ✅ PostgreSQL 免费 90 天
- ✅ 自动 HTTPS

### 限制

- ⚠️ 15 分钟无活动后休眠
- ⚠️ 冷启动需要 30-60 秒
- ⚠️ PostgreSQL 90 天后需付费（$7/月）

### 部署步骤

#### 1. 注册 Render 账号

1. 访问：https://render.com/
2. 使用 GitHub 账号注册
3. 无需信用卡

#### 2. 创建 PostgreSQL 数据库

1. 点击 **"New +"** → **"PostgreSQL"**
2. 配置：
   - **Name**: `todoapp-db`
   - **Database**: `todoapp`
   - **User**: `todouser`
   - **Region**: 选择最近的区域
   - **Plan**: **Free**
3. 点击 **"Create Database"**
4. 复制 **"Internal Database URL"**

#### 3. 部署后端B

1. 点击 **"New +"** → **"Web Service"**
2. 连接 GitHub 仓库
3. 配置：
   - **Name**: `todoapp-backend-b`
   - **Root Directory**: `backend-b`
   - **Environment**: `Docker`
   - **Plan**: **Free**
4. 添加环境变量：
   ```
   PORT_B=4000
   DATABASE_URL=粘贴 Internal Database URL
   ```
   或分别设置：
   ```
   POSTGRES_HOST=从数据库复制
   POSTGRES_PORT=5432
   POSTGRES_DB=todoapp
   POSTGRES_USER=todouser
   POSTGRES_PASSWORD=从数据库复制
   ```
5. 点击 **"Create Web Service"**
6. 复制服务 URL

#### 4. 部署后端A

1. 创建新的 Web Service
2. 配置：
   - **Name**: `todoapp-backend-a`
   - **Root Directory**: `backend-a`
   - **Environment**: `Docker`
3. 环境变量：
   ```
   PORT=3000
   BACKEND_B_URL=后端B的URL
   ```
4. 创建并复制 URL

#### 5. 部署前端

1. 创建新的 Web Service
2. 配置：
   - **Name**: `todoapp-frontend`
   - **Root Directory**: `frontend`
   - **Environment**: `Docker`
3. 环境变量：
   ```
   VITE_API_URL=后端A的URL
   ```
4. 创建

### Render 免费限制

- **Web Services**: 750 小时/月（单个服务）
- **PostgreSQL**: 免费 90 天，之后 $7/月
- **休眠**: 15 分钟无活动后休眠
- **冷启动**: 30-60 秒

---

## 🚀 方案3: Fly.io

### 优势

- ✅ 免费套餐慷慨
- ✅ 支持 Docker
- ✅ 全球部署
- ✅ 不会休眠

### 免费额度

- 3 个共享 CPU VM（256MB RAM）
- 3GB 持久化存储
- 160GB 出站流量/月

### 部署步骤

#### 1. 安装 Fly CLI

```powershell
# Windows
iwr https://fly.io/install.ps1 -useb | iex

# 验证安装
fly version
```

#### 2. 登录 Fly.io

```powershell
fly auth signup
# 或
fly auth login
```

#### 3. 创建 PostgreSQL 数据库

```powershell
fly postgres create --name todoapp-db --region sjc

# 记录输出的连接信息
```

#### 4. 部署后端B

```powershell
cd c:\Users\95150\OneDrive\桌面\my-fullstack-app\backend-b

# 初始化 Fly 应用
fly launch --name todoapp-backend-b --no-deploy

# 设置环境变量
fly secrets set PORT_B=4000
fly secrets set POSTGRES_HOST=todoapp-db.internal
fly secrets set POSTGRES_PORT=5432
fly secrets set POSTGRES_DB=todoapp
fly secrets set POSTGRES_USER=postgres
fly secrets set POSTGRES_PASSWORD=你的密码

# 部署
fly deploy
```

#### 5. 部署后端A

```powershell
cd ..\backend-a

fly launch --name todoapp-backend-a --no-deploy
fly secrets set PORT=3000
fly secrets set BACKEND_B_URL=https://todoapp-backend-b.fly.dev
fly deploy
```

#### 6. 部署前端

```powershell
cd ..\frontend

fly launch --name todoapp-frontend --no-deploy
fly secrets set VITE_API_URL=https://todoapp-backend-a.fly.dev
fly deploy
```

---

## 🚀 方案4: Vercel（仅前端）

### 适用场景

如果您愿意将后端改造为 Serverless Functions，Vercel 是最佳选择。

### 优势

- ✅ 完全免费（个人项目）
- ✅ 全球 CDN
- ✅ 自动 HTTPS
- ✅ 极快的部署速度

### 限制

- ❌ 不支持传统后端
- ❌ 需要改造为 Serverless Functions
- ❌ 不支持 PostgreSQL（需要使用外部数据库）

### 部署步骤（需要改造）

1. 将后端改造为 Vercel Serverless Functions
2. 使用外部数据库服务（如 Supabase、PlanetScale）
3. 部署前端到 Vercel

**注意**：需要较大的代码改造，不推荐作为第一选择。

---

## 🚀 方案5: AWS 免费套餐

### 免费额度（前 12 个月）

- **EC2**: 750 小时/月 t2.micro
- **RDS**: 750 小时/月 db.t2.micro
- **S3**: 5GB 存储
- **数据传输**: 15GB/月

### 要求

- ✅ 需要信用卡（验证扣 $1）
- ⚠️ 超出免费额度会收费
- ⚠️ 12 个月后恢复正常收费

### 适用场景

- 学习 AWS 服务
- 需要完整的云基础设施
- 计划长期使用 AWS

---

## 🎯 推荐选择

### 对于您的项目，我推荐：

#### 🥇 第一选择：Railway
- **原因**：
  - 最接近您现有的 Docker 配置
  - 无需信用卡
  - $5/月免费额度足够使用
  - 支持完整的全栈应用
  - 部署最简单

#### 🥈 第二选择：Render
- **原因**：
  - 完全免费（有休眠限制）
  - 适合低流量应用
  - PostgreSQL 免费 90 天

#### 🥉 第三选择：Fly.io
- **原因**：
  - 免费额度慷慨
  - 不会休眠
  - 全球部署
  - 但配置稍复杂

---

## 💡 免费数据库服务

如果您需要独立的免费数据库：

### 1. **Supabase**
- ✅ 免费 500MB PostgreSQL
- ✅ 自动备份
- ✅ 内置 API
- https://supabase.com/

### 2. **PlanetScale**
- ✅ 免费 5GB MySQL
- ✅ 无服务器
- ✅ 自动扩展
- https://planetscale.com/

### 3. **ElephantSQL**
- ✅ 免费 20MB PostgreSQL
- ✅ 适合小项目
- https://www.elephantsql.com/

### 4. **Neon**
- ✅ 免费 3GB PostgreSQL
- ✅ Serverless
- ✅ 自动休眠
- https://neon.tech/

---

## 📊 成本对比（小流量应用）

| 方案 | 第一年成本 | 第二年成本 | 限制 |
|------|-----------|-----------|------|
| Railway | $0 | $0-60 | $5/月免费额度 |
| Render | $0 | $84 | 数据库 $7/月 |
| Fly.io | $0 | $0 | 免费额度内 |
| AWS 免费 | $0 | $300-600 | 12个月后收费 |
| Vercel + Supabase | $0 | $0 | 需要改造 |

---

## ✅ 快速开始建议

### 立即行动（5分钟）

1. **注册 Railway 账号**：https://railway.app/
2. **连接 GitHub**
3. **创建 PostgreSQL 数据库**
4. **部署三个服务**（后端B、后端A、前端）
5. **完成！**

### 优势

- ✅ 无需信用卡
- ✅ 无需修改代码
- ✅ 5-10 分钟完成部署
- ✅ 自动 HTTPS
- ✅ 可以在本地 DBeaver 连接数据库

---

## 🆘 需要帮助？

如果您选择了某个方案并需要详细的部署步骤，请告诉我，我可以为您创建该平台的详细部署指南！

**推荐顺序**：
1. 先试 Railway（最简单）
2. 如果不满意，试 Render
3. 如果需要更多控制，试 Fly.io
4. 如果想学习 AWS，使用 AWS 免费套餐

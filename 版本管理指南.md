# 📌 版本管理指南

## 🎯 为什么需要版本管理？

### 问题场景
- ❌ 合作者不知道项目有哪些更新
- ❌ 不清楚什么时候引入了某个功能
- ❌ 升级后出问题，不知道改了什么
- ❌ 多人协作时版本混乱

### 解决方案
- ✅ 清晰的版本号
- ✅ 详细的更新日志
- ✅ Git 标签管理
- ✅ 规范的提交信息

---

## 📋 版本管理文件

### 1. CHANGELOG.md - 更新日志
记录每个版本的详细变更

**位置**: 项目根目录
**作用**: 
- 记录所有重要变更
- 帮助用户了解新功能
- 提供升级指南

### 2. VERSION - 版本号文件
当前版本号

**位置**: 项目根目录
**内容**: `2.0.0`
**作用**: 快速查看当前版本

### 3. package.json - NPM 版本
前端和后端的版本号

**位置**: `frontend/package.json`, `backend-a/package.json`, `backend-b/package.json`
**字段**: `"version": "2.0.0"`

---

## 🔢 语义化版本号 (SemVer)

### 格式：主版本号.次版本号.修订号

```
2.0.0
│ │ │
│ │ └─ 修订号 (Patch): Bug 修复
│ └─── 次版本号 (Minor): 新增功能（向后兼容）
└───── 主版本号 (Major): 重大变更（可能不兼容）
```

### 何时增加版本号？

#### 主版本号 (Major) - 1.x.x → 2.0.0
**重大架构变更、不兼容的修改**

例如：
- ✅ 从本地部署迁移到 Docker
- ✅ 数据库完全重构
- ✅ API 接口重大变更
- ✅ 删除旧功能

**本项目例子**:
```
1.2.0 → 2.0.0
原因: Docker 容器化，部署方式完全改变
```

#### 次版本号 (Minor) - 1.1.x → 1.2.0
**新增功能，向后兼容**

例如：
- ✅ 添加新功能
- ✅ 改进现有功能
- ✅ 添加新的 API 端点
- ✅ 性能优化

**本项目例子**:
```
1.1.0 → 1.2.0
原因: 添加双后端协作架构和智能分类功能
```

#### 修订号 (Patch) - 1.1.0 → 1.1.1
**Bug 修复、小改进**

例如：
- ✅ 修复 Bug
- ✅ 修复文档错误
- ✅ 小的 UI 调整
- ✅ 依赖更新

**本项目例子**:
```
2.0.0 → 2.0.1
原因: 修复端口冲突检测脚本的小问题
```

---

## 📝 如何更新版本

### 步骤 1: 决定版本号

根据变更类型选择：
- 重大变更 → 主版本号 +1
- 新功能 → 次版本号 +1
- Bug 修复 → 修订号 +1

### 步骤 2: 更新 CHANGELOG.md

在文件顶部添加新版本：

```markdown
## [2.0.1] - 2024-10-26

### 🔧 修复
- 修复启动脚本在某些情况下无法检测端口的问题
- 更新文档中的错误链接

### 📚 文档
- 添加版本管理指南
```

### 步骤 3: 更新 VERSION 文件

```
2.0.1
```

### 步骤 4: 更新 package.json

```json
{
  "version": "2.0.1"
}
```

### 步骤 5: Git 提交和标签

```bash
# 1. 提交变更
git add .
git commit -m "chore: 发布 v2.0.1

- 修复端口检测问题
- 更新文档
"

# 2. 创建 Git 标签
git tag -a v2.0.1 -m "版本 2.0.1

修复:
- 端口检测脚本优化
- 文档更新
"

# 3. 推送到远程
git push origin main
git push origin v2.0.1
```

---

## 🏷️ Git 标签管理

### 为什么使用标签？

- ✅ 标记重要版本
- ✅ 方便回退到特定版本
- ✅ GitHub 自动生成 Release

### 创建标签

```bash
# 创建带注释的标签（推荐）
git tag -a v2.0.0 -m "Docker 容器化版本"

# 查看所有标签
git tag

# 查看标签详情
git show v2.0.0

# 推送标签到远程
git push origin v2.0.0

# 推送所有标签
git push origin --tags
```

### 删除标签

```bash
# 删除本地标签
git tag -d v2.0.0

# 删除远程标签
git push origin :refs/tags/v2.0.0
```

### 检出特定版本

```bash
# 查看特定版本的代码
git checkout v2.0.0

# 基于标签创建新分支
git checkout -b hotfix-2.0.1 v2.0.0
```

---

## 📊 提交信息规范

### Conventional Commits 格式

```
<类型>(<范围>): <简短描述>

<详细描述>

<footer>
```

### 常用类型

| 类型 | 说明 | 例子 |
|------|------|------|
| `feat` | 新功能 | `feat: 添加用户认证功能` |
| `fix` | Bug 修复 | `fix: 修复登录页面崩溃问题` |
| `docs` | 文档更新 | `docs: 更新 README 部署说明` |
| `style` | 代码格式 | `style: 统一代码缩进为 2 空格` |
| `refactor` | 重构 | `refactor: 重构数据库连接逻辑` |
| `perf` | 性能优化 | `perf: 优化查询性能` |
| `test` | 测试 | `test: 添加单元测试` |
| `chore` | 构建/工具 | `chore: 更新依赖版本` |

### 提交示例

```bash
# 新功能
git commit -m "feat(auth): 添加 JWT 认证

- 实现用户登录
- 添加 token 验证中间件
- 更新 API 文档
"

# Bug 修复
git commit -m "fix(docker): 修复端口冲突问题

修复启动脚本无法正确检测 PostgreSQL 服务的问题

Closes #123
"

# 文档更新
git commit -m "docs: 添加版本管理指南

- 创建 CHANGELOG.md
- 添加版本管理流程说明
- 更新 README
"
```

---

## 🔄 版本发布流程

### 完整流程

```bash
# 1. 确保在 main 分支
git checkout main
git pull origin main

# 2. 更新版本号
# 编辑 CHANGELOG.md
# 编辑 VERSION
# 编辑 package.json

# 3. 提交版本更新
git add CHANGELOG.md VERSION package.json
git commit -m "chore: 发布 v2.1.0"

# 4. 创建标签
git tag -a v2.1.0 -m "版本 2.1.0 - 添加用户认证"

# 5. 推送到远程
git push origin main
git push origin v2.1.0

# 6. 在 GitHub 创建 Release（可选）
# 访问 GitHub → Releases → Draft a new release
# 选择标签 v2.1.0
# 填写 Release notes（从 CHANGELOG 复制）
# 发布
```

---

## 📱 GitHub Release

### 创建 Release

1. **访问 GitHub 仓库**
   ```
   https://github.com/你的用户名/my-fullstack-app
   ```

2. **点击 "Releases"**
   - 在右侧栏找到 "Releases"
   - 点击 "Draft a new release"

3. **填写信息**
   ```
   Tag version: v2.0.0
   Release title: v2.0.0 - Docker 容器化部署
   
   Description: 
   从 CHANGELOG.md 复制对应版本的内容
   ```

4. **发布**
   - 点击 "Publish release"

### Release 的好处

- ✅ 自动生成下载链接
- ✅ 展示版本历史
- ✅ 方便用户下载特定版本
- ✅ 专业的项目形象

---

## 🎯 实际操作示例

### 场景 1: 修复了一个 Bug

```bash
# 1. 修复代码
# 2. 测试确认修复

# 3. 更新 CHANGELOG.md
## [2.0.1] - 2024-10-26
### 🔧 修复
- 修复启动脚本端口检测问题

# 4. 更新 VERSION
2.0.1

# 5. 提交
git add .
git commit -m "fix: 修复启动脚本端口检测问题"

# 6. 创建标签
git tag -a v2.0.1 -m "修复端口检测"

# 7. 推送
git push origin main --tags
```

### 场景 2: 添加了新功能

```bash
# 1. 开发新功能
# 2. 测试功能

# 3. 更新 CHANGELOG.md
## [2.1.0] - 2024-10-27
### ✨ 新增
- 添加用户认证功能
- 实现 JWT token 验证

# 4. 更新 VERSION
2.1.0

# 5. 提交
git add .
git commit -m "feat: 添加用户认证功能"

# 6. 创建标签
git tag -a v2.1.0 -m "添加用户认证"

# 7. 推送
git push origin main --tags
```

### 场景 3: 重大架构升级

```bash
# 1. 完成架构升级
# 2. 全面测试

# 3. 更新 CHANGELOG.md
## [3.0.0] - 2024-11-01
### 🎉 重大更新
- 迁移到 Kubernetes
- 重构 API 架构
- 不兼容旧版本

### 📚 升级指南
详见文档...

# 4. 更新 VERSION
3.0.0

# 5. 提交
git add .
git commit -m "feat!: 迁移到 Kubernetes

BREAKING CHANGE: 部署方式完全改变，需要 K8s 环境
"

# 6. 创建标签
git tag -a v3.0.0 -m "Kubernetes 版本"

# 7. 推送
git push origin main --tags

# 8. 创建 GitHub Release 并标注为 "Breaking Changes"
```

---

## 📋 版本管理检查清单

### 发布新版本前

- [ ] 所有功能已测试
- [ ] 文档已更新
- [ ] CHANGELOG.md 已更新
- [ ] VERSION 文件已更新
- [ ] package.json 版本已更新
- [ ] 提交信息符合规范
- [ ] 创建了 Git 标签
- [ ] 推送到远程仓库
- [ ] （可选）创建 GitHub Release

---

## 🎓 最佳实践

### 1. 保持 CHANGELOG 更新
每次有重要变更就更新，不要等到发布时才写

### 2. 使用语义化版本
严格遵循 SemVer 规范，让版本号有意义

### 3. 写清楚的提交信息
使用 Conventional Commits 格式

### 4. 定期发布
不要积累太多变更才发布

### 5. 标注破坏性变更
主版本升级时，明确说明不兼容的地方

### 6. 提供升级指南
重大版本更新时，提供详细的升级步骤

---

## 📊 版本历史查看

### 查看所有版本

```bash
# 查看所有标签
git tag

# 查看标签详情
git tag -n

# 查看特定版本的变更
git show v2.0.0
```

### 比较版本差异

```bash
# 比较两个版本
git diff v1.0.0 v2.0.0

# 查看版本间的提交
git log v1.0.0..v2.0.0

# 简洁格式
git log v1.0.0..v2.0.0 --oneline
```

---

## ✅ 总结

### 你现在拥有的版本管理工具

1. ✅ **CHANGELOG.md** - 详细的更新日志
2. ✅ **VERSION** - 当前版本号
3. ✅ **版本管理指南.md** - 完整的流程说明
4. ✅ Git 标签系统
5. ✅ 规范的提交格式

### 日常工作流程

```
开发功能
  ↓
测试
  ↓
更新 CHANGELOG.md
  ↓
更新 VERSION
  ↓
提交代码（规范格式）
  ↓
创建 Git 标签
  ↓
推送到 GitHub
  ↓
（可选）创建 Release
```

---

**现在你的项目有了完整的版本管理系统！** 🎉

合作者可以清楚地知道：
- ✅ 当前版本是什么
- ✅ 每个版本有什么变化
- ✅ 如何升级到新版本
- ✅ 历史版本在哪里

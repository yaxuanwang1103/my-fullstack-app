# ğŸ“Š ç›‘æ§å’Œæ—¥å¿—å®Œæ•´æŒ‡å—

## ğŸ“ æ•°æ®å­˜å‚¨ä½ç½®

### PostgreSQL æ•°æ®åº“

**è¿æ¥ä¿¡æ¯ï¼š**
- Host: `localhost`
- Port: `5432`
- Database: `todoapp`
- Username: `postgres`
- Password: `postgres`

**æŸ¥çœ‹æ•°æ®ï¼š**

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ Docker å‘½ä»¤
docker exec -it todoapp-postgres psql -U postgres -d todoapp

# æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
SELECT * FROM messages ORDER BY "createdAt" DESC;

# ç»Ÿè®¡ä»»åŠ¡æ•°é‡
SELECT COUNT(*) as total FROM messages;

# æŒ‰ç±»åˆ«ç»Ÿè®¡
SELECT category, COUNT(*) as count 
FROM messages 
GROUP BY category;

# æŒ‰ä¼˜å…ˆçº§ç»Ÿè®¡
SELECT priority, COUNT(*) as count 
FROM messages 
GROUP BY priority;

# æŸ¥çœ‹æœ€è¿‘æ·»åŠ çš„ä»»åŠ¡
SELECT text, category, priority, "createdAt" 
FROM messages 
ORDER BY "createdAt" DESC 
LIMIT 10;
```

**ä½¿ç”¨å¯è§†åŒ–å·¥å…·ï¼š**

æ¨èå·¥å…·ï¼š
1. **DBeaver** (å…è´¹) - https://dbeaver.io/
2. **pgAdmin** (å…è´¹) - https://www.pgadmin.org/
3. **TablePlus** (ä»˜è´¹) - https://tableplus.com/

---

## ğŸ“ æ—¥å¿—æŸ¥çœ‹

### æœ¬åœ° Docker ç¯å¢ƒ

#### å®æ—¶æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡
docker-compose logs -f backend-a
docker-compose logs -f backend-b
docker-compose logs -f frontend
docker-compose logs -f postgres

# æŸ¥çœ‹æœ€è¿‘ N è¡Œ
docker-compose logs --tail=100 backend-a

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µ
docker-compose logs --since 2024-10-27T10:00:00 backend-a
docker-compose logs --since 30m backend-a  # æœ€è¿‘30åˆ†é’Ÿ

# åŒæ—¶æŸ¥çœ‹å¤šä¸ªæœåŠ¡
docker-compose logs -f backend-a backend-b
```

#### ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶

```bash
# ä¿å­˜æ‰€æœ‰æ—¥å¿—
docker-compose logs > logs/all-logs.txt

# ä¿å­˜ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs backend-a > logs/backend-a.log

# ä¿å­˜æœ€è¿‘çš„æ—¥å¿—
docker-compose logs --tail=1000 > logs/recent-logs.txt
```

#### æ—¥å¿—æ–‡ä»¶ä½ç½®

**Windows:**
```
C:\ProgramData\Docker\containers\<container-id>\<container-id>-json.log
```

**æŸ¥çœ‹å®¹å™¨ ID:**
```bash
docker ps
```

---

## ğŸ“Š è®¿é—®ç»Ÿè®¡ï¼ˆéœ€è¦æ·»åŠ ï¼‰

### å½“å‰çŠ¶æ€ï¼šæœªå®ç°

ä½ çš„é¡¹ç›®ç›®å‰**æ²¡æœ‰**è®¿é—®ç»Ÿè®¡åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å®ç°æ–¹æ¡ˆï¼š

### æ–¹æ¡ˆ 1ï¼šæ·»åŠ ç®€å•çš„è®¿é—®æ—¥å¿—

åœ¨åç«¯æ·»åŠ ä¸­é—´ä»¶è®°å½•æ¯æ¬¡è¯·æ±‚ã€‚

**backend-a/server.js æ·»åŠ ï¼š**

```javascript
// è®¿é—®æ—¥å¿—ä¸­é—´ä»¶
app.use((req, res, next) => {
  const timestamp = new Date().toISOString();
  const method = req.method;
  const url = req.url;
  const ip = req.ip || req.connection.remoteAddress;
  
  console.log(`[${timestamp}] ${method} ${url} - IP: ${ip}`);
  next();
});
```

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨æ•°æ®åº“è®°å½•è®¿é—®

åˆ›å»ºè®¿é—®è®°å½•è¡¨ï¼š

```sql
CREATE TABLE access_logs (
  id SERIAL PRIMARY KEY,
  ip VARCHAR(50),
  method VARCHAR(10),
  url VARCHAR(255),
  user_agent TEXT,
  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡

**æ¨èå·¥å…·ï¼š**
1. **Google Analytics** - å…è´¹ï¼ŒåŠŸèƒ½å¼ºå¤§
2. **Plausible** - éšç§å‹å¥½
3. **Umami** - å¼€æºï¼Œå¯è‡ªæ‰˜ç®¡

---

## ğŸ” ç›‘æ§ç¨‹åºæ˜¯å¦å´©æºƒ

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

#### æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹å®¹å™¨å¥åº·çŠ¶æ€
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

# æ£€æŸ¥å®¹å™¨æ˜¯å¦åœ¨è¿è¡Œ
docker inspect todoapp-backend-a --format='{{.State.Status}}'
```

#### ç›‘æ§è„šæœ¬

åˆ›å»ºä¸€ä¸ªç›‘æ§è„šæœ¬ `monitor.sh`ï¼š

```bash
#!/bin/bash

while true; do
  echo "=== $(date) ==="
  
  # æ£€æŸ¥å®¹å™¨çŠ¶æ€
  docker-compose ps
  
  # æ£€æŸ¥ç«¯å£æ˜¯å¦å“åº”
  curl -f http://localhost:5173 > /dev/null 2>&1 && echo "âœ… Frontend OK" || echo "âŒ Frontend DOWN"
  curl -f http://localhost:3000/health > /dev/null 2>&1 && echo "âœ… Backend-A OK" || echo "âŒ Backend-A DOWN"
  curl -f http://localhost:4000/health > /dev/null 2>&1 && echo "âœ… Backend-B OK" || echo "âŒ Backend-B DOWN"
  
  echo ""
  sleep 60  # æ¯60ç§’æ£€æŸ¥ä¸€æ¬¡
done
```

---

## ğŸš¨ ç¨‹åºå´©æºƒäº†æ€ä¹ˆåŠï¼Ÿ

### æ­¥éª¤ 1ï¼šæŸ¥çœ‹å®¹å™¨çŠ¶æ€

```bash
# æŸ¥çœ‹å“ªä¸ªå®¹å™¨å´©æºƒäº†
docker-compose ps

# æŸ¥çœ‹å´©æºƒå®¹å™¨çš„æ—¥å¿—
docker-compose logs --tail=100 <service-name>
```

### æ­¥éª¤ 2ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯
docker-compose logs --tail=200 backend-a | grep -i error
docker-compose logs --tail=200 backend-a | grep -i exception

# æŸ¥çœ‹å®Œæ•´æ—¥å¿—
docker-compose logs backend-a > crash-log.txt
```

### æ­¥éª¤ 3ï¼šé‡å¯æœåŠ¡

```bash
# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend-a

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# å®Œå…¨é‡æ–°å¯åŠ¨
docker-compose down
docker-compose up -d
```

### æ­¥éª¤ 4ï¼šæŸ¥çœ‹ç³»ç»Ÿèµ„æº

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç£ç›˜ç©ºé—´
docker system df

# æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
docker system prune
```

---

## ğŸ“ˆ ç”Ÿäº§ç¯å¢ƒç›‘æ§ï¼ˆAWS ECSï¼‰

### æŸ¥çœ‹ ECS æ—¥å¿—

```bash
# ä½¿ç”¨ AWS CLI æŸ¥çœ‹æ—¥å¿—
aws logs tail /ecs/todoapp-frontend --follow

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
aws logs filter-log-events \
  --log-group-name /ecs/todoapp-backend-a \
  --start-time $(date -d '1 hour ago' +%s)000

# æœç´¢é”™è¯¯æ—¥å¿—
aws logs filter-log-events \
  --log-group-name /ecs/todoapp-backend-a \
  --filter-pattern "ERROR"
```

### åœ¨ AWS Console æŸ¥çœ‹

1. æ‰“å¼€ AWS Console
2. è¿›å…¥ **CloudWatch** â†’ **Log groups**
3. æ‰¾åˆ°ä½ çš„æ—¥å¿—ç»„ï¼š
   - `/ecs/todoapp-frontend`
   - `/ecs/todoapp-backend-a`
   - `/ecs/todoapp-backend-b`
4. ç‚¹å‡»æŸ¥çœ‹æ—¥å¿—æµ

### è®¾ç½®å‘Šè­¦

åœ¨ CloudWatch ä¸­è®¾ç½®å‘Šè­¦ï¼š

1. **CPU ä½¿ç”¨ç‡è¿‡é«˜**
2. **å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜**
3. **é”™è¯¯æ—¥å¿—æ•°é‡æ¿€å¢**
4. **æœåŠ¡ä¸å¯ç”¨**

---

## ğŸ› ï¸ æ¨èçš„ç›‘æ§å·¥å…·

### å…è´¹å·¥å…·

1. **Grafana + Prometheus**
   - åŠŸèƒ½å¼ºå¤§
   - å¯è§†åŒ–ç›‘æ§
   - å¼€æºå…è´¹

2. **Uptime Kuma**
   - ç®€å•æ˜“ç”¨
   - ç›‘æ§æœåŠ¡å¯ç”¨æ€§
   - å¼€æºå…è´¹

3. **Netdata**
   - å®æ—¶ç›‘æ§
   - è‡ªåŠ¨å®‰è£…
   - å¼€æºå…è´¹

### ä»˜è´¹å·¥å…·

1. **Datadog** - å…¨é¢çš„ç›‘æ§è§£å†³æ–¹æ¡ˆ
2. **New Relic** - APM æ€§èƒ½ç›‘æ§
3. **Sentry** - é”™è¯¯è¿½è¸ª

---

## ğŸ“Š å®ç”¨æŸ¥è¯¢å‘½ä»¤

### æ•°æ®åº“ç»Ÿè®¡

```sql
-- æ€»ä»»åŠ¡æ•°
SELECT COUNT(*) FROM messages;

-- ä»Šå¤©æ–°å¢çš„ä»»åŠ¡
SELECT COUNT(*) FROM messages 
WHERE DATE("createdAt") = CURRENT_DATE;

-- æœ¬å‘¨æ–°å¢çš„ä»»åŠ¡
SELECT COUNT(*) FROM messages 
WHERE "createdAt" >= DATE_TRUNC('week', CURRENT_DATE);

-- æŒ‰æ—¥æœŸç»Ÿè®¡
SELECT DATE("createdAt") as date, COUNT(*) as count
FROM messages
GROUP BY DATE("createdAt")
ORDER BY date DESC;

-- æŒ‰å°æ—¶ç»Ÿè®¡ï¼ˆæŸ¥çœ‹é«˜å³°æœŸï¼‰
SELECT EXTRACT(HOUR FROM "createdAt") as hour, COUNT(*) as count
FROM messages
WHERE DATE("createdAt") = CURRENT_DATE
GROUP BY hour
ORDER BY hour;
```

### Docker ç»Ÿè®¡

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats --no-stream

# æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¶é—´
docker inspect todoapp-backend-a --format='{{.State.StartedAt}}'

# æŸ¥çœ‹å®¹å™¨é‡å¯æ¬¡æ•°
docker inspect todoapp-backend-a --format='{{.RestartCount}}'

# æŸ¥çœ‹å®¹å™¨ç½‘ç»œæµé‡
docker stats --format "table {{.Container}}\t{{.NetIO}}"
```

---

## ğŸ”§ æ·»åŠ å¥åº·æ£€æŸ¥

### Docker Compose å¥åº·æ£€æŸ¥

åœ¨ `docker-compose.yml` ä¸­æ·»åŠ ï¼š

```yaml
services:
  backend-a:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
  
  backend-b:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
```

### æŸ¥çœ‹å¥åº·çŠ¶æ€

```bash
# æŸ¥çœ‹å¥åº·çŠ¶æ€
docker-compose ps

# è¯¦ç»†å¥åº·ä¿¡æ¯
docker inspect todoapp-backend-a --format='{{.State.Health.Status}}'
```

---

## ğŸ“± å®æ—¶ç›‘æ§è„šæœ¬

åˆ›å»º `monitor.ps1` (Windows PowerShell):

```powershell
while ($true) {
    Clear-Host
    Write-Host "=== æœåŠ¡ç›‘æ§ $(Get-Date) ===" -ForegroundColor Green
    
    # æ£€æŸ¥å®¹å™¨çŠ¶æ€
    docker-compose ps
    
    # æ£€æŸ¥æœåŠ¡å“åº”
    try {
        $frontend = Invoke-WebRequest -Uri "http://localhost:5173" -UseBasicParsing -TimeoutSec 5
        Write-Host "âœ… Frontend: OK" -ForegroundColor Green
    } catch {
        Write-Host "âŒ Frontend: DOWN" -ForegroundColor Red
    }
    
    try {
        $backendA = Invoke-WebRequest -Uri "http://localhost:3000/health" -UseBasicParsing -TimeoutSec 5
        Write-Host "âœ… Backend-A: OK" -ForegroundColor Green
    } catch {
        Write-Host "âŒ Backend-A: DOWN" -ForegroundColor Red
    }
    
    try {
        $backendB = Invoke-WebRequest -Uri "http://localhost:4000/health" -UseBasicParsing -TimeoutSec 5
        Write-Host "âœ… Backend-B: OK" -ForegroundColor Green
    } catch {
        Write-Host "âŒ Backend-B: DOWN" -ForegroundColor Red
    }
    
    # æ˜¾ç¤ºèµ„æºä½¿ç”¨
    Write-Host "`n=== èµ„æºä½¿ç”¨ ===" -ForegroundColor Yellow
    docker stats --no-stream
    
    Start-Sleep -Seconds 60
}
```

è¿è¡Œï¼š
```powershell
.\monitor.ps1
```

---

## ğŸ“‹ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹æ•°æ®
docker exec -it todoapp-postgres psql -U postgres -d todoapp

# æ£€æŸ¥çŠ¶æ€
docker-compose ps

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹èµ„æº
docker stats

# æ¸…ç†æ—¥å¿—
docker-compose logs --tail=0 > /dev/null
```

### ç´§æ€¥æƒ…å†µå¤„ç†

```bash
# 1. æŸ¥çœ‹å“ªä¸ªæœåŠ¡å´©æºƒ
docker-compose ps

# 2. æŸ¥çœ‹å´©æºƒæ—¥å¿—
docker-compose logs --tail=200 <service>

# 3. é‡å¯æœåŠ¡
docker-compose restart <service>

# 4. å¦‚æœè¿˜ä¸è¡Œï¼Œå®Œå…¨é‡å¯
docker-compose down
docker-compose up -d

# 5. æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose logs <service> | grep -i error
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. âœ… åˆ›å»ºç›‘æ§è„šæœ¬
2. âœ… è®¾ç½®æ—¥å¿—è½®è½¬
3. âœ… æ·»åŠ è®¿é—®ç»Ÿè®¡
4. âœ… é…ç½®å‘Šè­¦é€šçŸ¥
5. âœ… å®šæœŸå¤‡ä»½æ•°æ®åº“

---

éœ€è¦æˆ‘å¸®ä½ å®ç°ä»»ä½•ç›‘æ§åŠŸèƒ½å—ï¼Ÿ

# 🚀 启动脚本使用说明

## 📋 可用脚本

| 脚本文件 | 功能 | 使用场景 |
|---------|------|---------|
| `start-docker.bat` | 智能启动 Docker | 日常启动（推荐） |
| `start-docker.ps1` | PowerShell 高级启动 | 需要详细控制 |
| `stop-docker.bat` | 停止所有容器 | 关闭项目 |
| `check-ports.bat` | 检查端口占用 | 排查问题 |

---

## 🎯 方案 1: 使用 start-docker.bat（最简单）

### 使用方法

1. **双击 `start-docker.bat`**
2. 脚本会自动：
   - ✅ 检查端口占用
   - ✅ 自动停止占用端口的进程
   - ✅ 启动 Docker 容器
   - ✅ 显示访问地址

### 特点

- ✅ 一键启动，无需手动操作
- ✅ 自动处理端口冲突
- ✅ 适合日常使用

---

## 🎯 方案 2: 使用 start-docker.ps1（高级）

### 使用方法

1. **右键 `start-docker.ps1`**
2. 选择 **"使用 PowerShell 运行"**
3. 如果有端口冲突，会提示选择：
   - 选项 1: 自动停止占用进程（推荐）
   - 选项 2: 使用其他端口
   - 选项 3: 手动处理
   - 选项 4: 退出

### 特点

- ✅ 交互式选择
- ✅ 显示详细的进程信息
- ✅ 更多控制选项

### 如果提示"无法运行脚本"

```powershell
# 以管理员身份运行 PowerShell，执行：
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

---

## 🔍 方案 3: 使用 check-ports.bat（检查工具）

### 使用方法

1. **双击 `check-ports.bat`**
2. 查看所有端口占用情况
3. 根据提示手动处理或运行 `start-docker.bat`

### 适用场景

- 🔍 排查端口冲突
- 🔍 查看哪个进程占用了端口
- 🔍 启动前预检查

---

## 🛑 停止 Docker

### 使用方法

**双击 `stop-docker.bat`** 即可停止所有容器

---

## 📊 完整工作流程

### 日常启动流程

```
1. 双击 start-docker.bat
   ↓
2. 等待自动处理端口冲突
   ↓
3. 看到 "✅ Docker 容器启动成功"
   ↓
4. 打开浏览器访问 http://localhost:5173
```

### 遇到问题时

```
1. 双击 check-ports.bat
   ↓
2. 查看哪些端口被占用
   ↓
3. 双击 start-docker.bat 自动处理
   ↓
4. 如果还有问题，使用 start-docker.ps1 手动选择
```

---

## 🔧 手动处理端口冲突

### 方法 1: 停止特定进程

```powershell
# 查看占用端口的进程
netstat -ano | findstr :5433

# 停止进程（替换 PID）
taskkill /F /PID <进程ID>
```

### 方法 2: 停止 PostgreSQL 服务

```powershell
# 停止服务
Stop-Service postgresql*

# 或在服务管理器中手动停止
services.msc
```

### 方法 3: 修改端口

编辑 `docker-compose.yml`，修改端口映射：

```yaml
postgres:
  ports:
    - "5434:5432"  # 改为其他端口
```

---

## 🎯 推荐使用方式

### 场景 1: 日常开发

```
直接双击 start-docker.bat
```

### 场景 2: 首次使用

```
1. 先运行 check-ports.bat 查看端口
2. 再运行 start-docker.bat 启动
```

### 场景 3: 遇到问题

```
1. 运行 check-ports.bat 诊断
2. 运行 start-docker.ps1 选择处理方式
```

### 场景 4: 关闭项目

```
双击 stop-docker.bat
```

---

## ⚠️ 常见问题

### Q1: start-docker.bat 没有自动停止进程？

**A:** 可能需要管理员权限

**解决：**
1. 右键 `start-docker.bat`
2. 选择 **"以管理员身份运行"**

### Q2: PowerShell 脚本无法运行？

**A:** 执行策略限制

**解决：**
```powershell
# 以管理员身份运行 PowerShell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Q3: 端口还是被占用？

**A:** 可能是系统服务

**解决：**
1. 打开 `services.msc`
2. 找到 PostgreSQL 服务
3. 停止并设置为"手动"

### Q4: 想要修改检查的端口？

**A:** 编辑脚本文件

在 `start-docker.bat` 或 `check-ports.bat` 中修改端口号

---

## 📝 脚本工作原理

### start-docker.bat 流程

```
1. 检查端口 5173, 3000, 4000, 5433
   ↓
2. 如果端口被占用
   ├─ 检查是否是 PostgreSQL 服务
   │  └─ 是：停止服务
   └─ 否：强制结束进程
   ↓
3. 停止现有 Docker 容器
   ↓
4. 启动新的 Docker 容器
   ↓
5. 显示访问地址
```

### check-ports.bat 流程

```
1. 检查每个端口
   ↓
2. 如果被占用
   ├─ 显示进程 ID
   └─ 显示进程名称
   ↓
3. 给出处理建议
```

---

## 🎨 自定义脚本

### 添加新端口检查

编辑 `start-docker.bat`，添加：

```batch
for /f "tokens=5" %%a in ('netstat -ano ^| findstr :新端口 ^| findstr LISTENING') do (
    echo ⚠️  端口 新端口 被占用，正在停止进程...
    taskkill /F /PID %%a >nul 2>&1
)
```

### 修改启动参数

在 `start-docker.bat` 中修改：

```batch
REM 原来
docker-compose up -d

REM 改为后台启动并查看日志
docker-compose up -d && docker-compose logs -f
```

---

## ✅ 最佳实践

1. **每次启动前运行 `check-ports.bat`** - 预防问题
2. **使用 `start-docker.bat` 启动** - 自动处理冲突
3. **关闭项目时运行 `stop-docker.bat`** - 释放资源
4. **遇到问题时查看日志** - `docker-compose logs -f`

---

## 🚀 快速开始

### 第一次使用

```
1. 双击 check-ports.bat（检查端口）
2. 双击 start-docker.bat（启动项目）
3. 打开浏览器访问 http://localhost:5173
```

### 日常使用

```
双击 start-docker.bat 即可！
```

---

**提示：** 建议将 `start-docker.bat` 固定到任务栏，方便快速启动！📌
